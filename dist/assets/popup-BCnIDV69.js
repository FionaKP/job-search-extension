import{r as n,j as e,e as he,c as me,R as pe}from"./extractor-BlsyOXNW.js";const xe={1:"Low",2:"Medium",3:"High"},ge=["remote","hybrid","onsite","startup","enterprise","contract"],N="postings";async function S(){return(await chrome.storage.local.get(N))[N]||[]}async function je(a){const o=await S(),i=Date.now();let r,l;if(a.description)try{r=he(a.description),l=i}catch(j){console.warn("Failed to extract keywords:",j)}const d={id:`job_${i}_${Math.random().toString(36).substring(2,9)}`,url:a.url||"",company:a.company||"",title:a.title||"",location:a.location||"",description:a.description||"",salary:a.salary,status:"saved",priority:a.priority||2,dateAdded:i,dateModified:i,notes:a.notes||"",tags:a.tags||[],connectionIds:[],keywords:r,keywordsExtractedAt:l};return o.unshift(d),await chrome.storage.local.set({[N]:o}),d}async function ye(a,o){const i=await S(),r=i.findIndex(l=>l.id===a);return r===-1?null:(i[r]={...i[r],...o,dateModified:Date.now()},await chrome.storage.local.set({[N]:i}),i[r])}async function fe(a){const o=await S(),i=l=>{try{const d=new URL(l);return`${d.origin}${d.pathname}`.replace(/\/$/,"")}catch{return l}},r=i(a);return o.find(l=>i(l.url)===r)||null}function ve(){const[a,o]=n.useState(""),[i,r]=n.useState(""),[l,d]=n.useState(""),[j,C]=n.useState(""),[k,J]=n.useState(""),[h,y]=n.useState([]),[B,D]=n.useState(""),[O,L]=n.useState(""),[P,T]=n.useState(2),[U,Y]=n.useState(!1),[,Q]=n.useState(null),[c,f]=n.useState({source:"",confidence:0,isLoading:!1,error:null}),[v,_]=n.useState(!1),[R,X]=n.useState({total:0,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0}),[q,Z]=n.useState([]),[E,G]=n.useState(!0),[K,W]=n.useState(!1),[ee,se]=n.useState(!1),[u,x]=n.useState(null),[p,te]=n.useState(null),[g,ne]=n.useState(""),[z,ae]=n.useState(!1),M=n.useCallback(async()=>{const s=await S(),t={total:s.length,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0};s.forEach(m=>{m.status in t&&t[m.status]++}),X(t),Z(s.slice(0,3))},[]),w=n.useCallback(s=>{o(s.title||""),r(s.company||""),d(s.location||""),C(s.salary||""),J(s.description||""),"tags"in s&&Array.isArray(s.tags)&&y(s.tags),"notes"in s&&L(s.notes||""),"priority"in s&&T(s.priority),"source"in s&&"confidence"in s&&(Q(s),f({source:s.source||"",confidence:s.confidence||0,isLoading:!1,error:!s.title&&!s.company?"Could not detect job details. Please fill in manually.":null}))},[]),A=n.useCallback(async s=>{f(t=>({...t,isLoading:!0,error:null}));try{await new Promise(m=>setTimeout(m,50));const t=await chrome.tabs.sendMessage(s,{action:"scrapeJob"});t&&w(t)}catch(t){console.log("Scraping not available:",t),f({source:"",confidence:0,isLoading:!1,error:"This page cannot be scraped. Please fill in manually."})}},[w]);n.useEffect(()=>{async function s(){G(!0);try{const m=new URLSearchParams(window.location.search).get("sourceUrl");let F=null,b;if(m)b=m,ae(!0);else{const[V]=await chrome.tabs.query({active:!0,currentWindow:!0});b=V.url||"",F=V.id||null}ne(b);const $=await fe(b);$?(te($),w($)):F&&await A(F),await M()}catch(t){console.error("Init error:",t),x("Could not load page information")}finally{G(!1)}}s()},[w,A,M]);const ie=async s=>{if(s.preventDefault(),x(null),!a.trim()){x("Job title is required");return}if(!i.trim()){x("Company name is required");return}W(!0);try{const t={url:g,title:a.trim(),company:i.trim(),location:l.trim(),salary:j.trim()||void 0,description:k.trim(),notes:O.trim(),priority:P,tags:h};p?await ye(p.id,t):await je(t),se(!0),await M(),z||setTimeout(()=>window.close(),1500)}catch(t){console.error("Save error:",t),x("Failed to save application")}finally{W(!1)}},H=s=>{const t=s.trim().toLowerCase();t&&!h.includes(t)&&y([...h,t]),D("")},re=s=>{y(h.filter(t=>t!==s))},ce=s=>{(s.key==="Enter"||s.key===",")&&(s.preventDefault(),H(B))},I=()=>{_(!0),f({source:"",confidence:0,isLoading:!1,error:null}),o(""),r(""),d(""),C(""),J(""),y([]),L(""),T(2)},le=()=>{chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},oe=()=>{const s=chrome.runtime.getURL("src/popup/popup.html")+"?sourceUrl="+encodeURIComponent(g);chrome.tabs.create({url:s}),window.close()},de=(()=>{try{const s=new URL(g),t=s.pathname.slice(0,25);return s.hostname+t+(s.pathname.length>25?"...":"")}catch{return g.slice(0,35)+"..."}})(),ue=s=>s>=.6?"notice-success":s>=.3?"notice-warning":"notice-error";return e.jsxs("div",{className:"popup-container",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"JobFlow"}),e.jsxs("div",{className:"header-actions",children:[!z&&e.jsx("button",{className:"btn-icon",title:"Open in new tab",onClick:oe,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})}),e.jsx("button",{className:"btn-icon",title:"Open Dashboard",onClick:le,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})})]})]}),e.jsxs("div",{className:"current-url",children:[e.jsx("span",{className:"url-label",children:"From:"}),e.jsx("span",{className:"url-text",title:g,children:de})]}),c.isLoading&&e.jsxs("div",{className:"notice notice-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Scanning page..."})]}),v&&!c.isLoading&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"Manual entry mode"}),e.jsx("button",{className:"btn-link",onClick:async()=>{_(!1);const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});s.id&&A(s.id)},children:"Try auto-detect"})]}),!v&&c.source&&!c.isLoading&&c.confidence>0&&e.jsxs("div",{className:`notice ${ue(c.confidence)}`,children:[e.jsxs("span",{children:[e.jsx("strong",{children:c.source})," • ",Math.round(c.confidence*100),"% confidence"]}),e.jsx("button",{className:"btn-link",onClick:I,children:"Edit manually"})]}),!v&&c.error&&e.jsxs("div",{className:"notice notice-warning",children:[e.jsx("span",{children:c.error}),e.jsx("button",{className:"btn-link",onClick:I,children:"Enter manually"})]}),!v&&!c.isLoading&&!c.source&&!c.error&&!p&&!E&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"No job detected on this page"}),e.jsx("button",{className:"btn-link",onClick:I,children:"Enter manually"})]}),p&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"Already saved"}),e.jsx("button",{className:"btn-link",onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${p.id}`)}),children:"View"})]}),E&&e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Loading..."})]}),!E&&e.jsxs("form",{className:"job-form",onSubmit:ie,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Job Title *"}),e.jsx("input",{type:"text",id:"title",value:a,onChange:s=>o(s.target.value),placeholder:"e.g., Software Engineer",className:u!=null&&u.includes("title")?"error":""})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company",children:"Company *"}),e.jsx("input",{type:"text",id:"company",value:i,onChange:s=>r(s.target.value),placeholder:"e.g., Acme Corp",className:u!=null&&u.includes("Company")?"error":""})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",value:l,onChange:s=>d(s.target.value),placeholder:"e.g., Remote"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"salary",children:"Salary"}),e.jsx("input",{type:"text",id:"salary",value:j,onChange:s=>C(s.target.value),placeholder:"e.g., $150k"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Priority"}),e.jsxs("div",{className:"star-rating",children:[[1,2,3].map(s=>e.jsx("button",{type:"button",className:`star-btn ${s<=P?"active":""}`,onClick:()=>T(s),children:"★"},s)),e.jsx("span",{className:"star-label",children:xe[P]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tags"}),e.jsxs("div",{className:"tags-container",children:[h.map(s=>e.jsxs("span",{className:"tag-chip",children:[s,e.jsx("button",{type:"button",onClick:()=>re(s),className:"tag-remove",children:"×"})]},s)),e.jsx("input",{type:"text",value:B,onChange:s=>D(s.target.value),onKeyDown:ce,placeholder:h.length===0?"Add tags...":"",className:"tag-input"})]}),h.length===0&&e.jsx("div",{className:"suggested-tags",children:ge.slice(0,4).map(s=>e.jsxs("button",{type:"button",onClick:()=>H(s),className:"suggested-tag",children:["+ ",s]},s))})]}),k&&e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"description-header",children:[e.jsx("label",{children:"Description"}),e.jsx("button",{type:"button",onClick:()=>Y(!U),className:"btn-link",children:U?"Hide":"Show"})]}),U&&e.jsx("div",{className:"description-preview",children:k})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",value:O,onChange:s=>L(s.target.value),rows:2,placeholder:"Personal notes..."})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:K,children:K?"Saving...":p?"Update":"Save to JobFlow"})})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:R.total}),e.jsx("span",{className:"stat-label",children:"Tracked"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:R.applied}),e.jsx("span",{className:"stat-label",children:"Applied"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:R.interviewing}),e.jsx("span",{className:"stat-label",children:"Interviews"})]})]}),q.length>0&&e.jsxs("div",{className:"recent-postings",children:[e.jsx("div",{className:"recent-header",children:"Recent"}),e.jsx("ul",{className:"recent-list",children:q.map(s=>e.jsxs("li",{className:"recent-item",onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${s.id}`)}),children:[e.jsx("span",{className:"recent-title",children:s.title}),e.jsxs("span",{className:"recent-company",children:["@ ",s.company]})]},s.id))})]}),ee&&e.jsx("div",{className:"notice notice-success",children:"Saved successfully!"}),u&&e.jsx("div",{className:"notice notice-error",children:u})]})}me.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(ve,{})}));
