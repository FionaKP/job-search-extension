import{r,j as e,c as W,R as _}from"./client-DYDkQYN6.js";const R=["Not rated","Low priority","Medium priority","High priority"],f="postings";async function w(){return(await chrome.storage.local.get(f))[f]||[]}async function q(s){const o=await w(),n=Date.now(),l={id:`job_${n}_${Math.random().toString(36).substring(2,9)}`,url:s.url||"",company:s.company||"",title:s.title||"",location:s.location||"",description:s.description||"",salary:s.salary,status:"saved",priority:s.priority||2,dateAdded:n,dateModified:n,notes:s.notes||"",tags:s.tags||[],connectionIds:[]};return o.unshift(l),await chrome.storage.local.set({[f]:o}),l}async function z(s,o){const n=await w(),l=n.findIndex(c=>c.id===s);return l===-1?null:(n[l]={...n[l],...o,dateModified:Date.now()},await chrome.storage.local.set({[f]:n}),n[l])}async function H(s){const o=await w(),n=c=>{try{const x=new URL(c);return`${x.origin}${x.pathname}`.replace(/\/$/,"")}catch{return c}},l=n(s);return o.find(c=>n(c.url)===l)||null}function V(){const[s,o]=r.useState({url:"",title:"",company:"",location:"",salary:"",tags:"",notes:"",companyUrl:"",portalUrl:""}),[n,l]=r.useState(2),[c,x]=r.useState({total:0,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0}),[b,L]=r.useState([]),[S,U]=r.useState(!0),[A,E]=r.useState(!1),[C,g]=r.useState(null),[h,I]=r.useState(null),[m,F]=r.useState(""),[P,T]=r.useState(!1),v=r.useCallback(async()=>{const t=await w(),a={total:t.length,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0};t.forEach(i=>{i.status in a&&a[i.status]++}),x(a),L(t.slice(0,3))},[]),y=r.useCallback(t=>{o(a=>({...a,title:t.title||a.title,company:t.company||a.company,location:t.location||a.location,salary:t.salary||a.salary,notes:t.notes||a.notes,tags:Array.isArray(t.tags)?t.tags.join(", "):a.tags})),t.priority&&l(t.priority)},[]),k=r.useCallback(async t=>{try{await chrome.scripting.executeScript({target:{tabId:t},files:["src/content/scraper.ts"]}),await new Promise(i=>setTimeout(i,100));const a=await chrome.tabs.sendMessage(t,{action:"scrapeJob"});a&&y(a)}catch(a){console.log("Scraping not available on this page:",a)}},[y]);r.useEffect(()=>{async function t(){U(!0);try{const i=new URLSearchParams(window.location.search).get("sourceUrl");let p=null,u;if(i)u=i,T(!0);else{const[j]=await chrome.tabs.query({active:!0,currentWindow:!0});u=j.url||"",p=j.id||null}F(u),o(j=>({...j,url:u}));const N=await H(u);N?(I(N.id),y(N)):p&&await k(p),await v()}catch(a){console.error("Init error:",a),g("Could not load page information")}finally{U(!1)}}t()},[y,k,v]);const d=t=>{const{name:a,value:i}=t.target;o(p=>({...p,[a]:i}))},J=async t=>{if(t.preventDefault(),!s.title.trim()||!s.company.trim()){g("Please enter job title and company");return}try{const a={url:m,title:s.title.trim(),company:s.company.trim(),location:s.location.trim(),salary:s.salary.trim(),notes:s.notes.trim(),priority:n,tags:s.tags.split(",").map(i=>i.trim().toLowerCase()).filter(i=>i.length>0)};h?await z(h,a):await q(a),E(!0),g(null),await v(),P||setTimeout(()=>window.close(),1500)}catch(a){console.error("Save error:",a),g("Failed to save application")}},$=()=>{chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},M=()=>{const t=chrome.runtime.getURL("src/popup/popup.html")+"?sourceUrl="+encodeURIComponent(m);chrome.tabs.create({url:t}),window.close()},B=()=>{chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${h}`)})},O=(()=>{try{const t=new URL(m),a=t.pathname.slice(0,30);return t.hostname+a+(t.pathname.length>30?"...":"")}catch{return m.slice(0,40)+"..."}})();return e.jsxs("div",{className:"popup-container",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"Job Tracker"}),e.jsxs("div",{className:"header-actions",children:[!P&&e.jsx("button",{className:"btn-icon",title:"Open in new tab (stays open while you copy/paste)",onClick:M,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})}),e.jsx("button",{className:"btn-icon",title:"Open Dashboard",onClick:$,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})})]})]}),e.jsxs("div",{className:"current-url",children:[e.jsx("span",{className:"url-label",children:"Saving from:"}),e.jsx("span",{className:"url-text",title:m,children:O})]}),h&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"This job is already saved"}),e.jsx("button",{className:"btn-link",onClick:B,children:"View in Dashboard"})]}),S&&e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Scanning page..."})]}),!S&&e.jsxs("form",{className:"job-form",onSubmit:J,children:[e.jsx("input",{type:"hidden",name:"url",value:s.url}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Job Title *"}),e.jsx("input",{type:"text",id:"title",name:"title",placeholder:"e.g., Software Engineer",required:!0,value:s.title,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company",children:"Company *"}),e.jsx("input",{type:"text",id:"company",name:"company",placeholder:"e.g., Acme Corp",required:!0,value:s.company,onChange:d})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",name:"location",placeholder:"e.g., Remote",value:s.location,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"salary",children:"Salary"}),e.jsx("input",{type:"text",id:"salary",name:"salary",placeholder:"e.g., $100k",value:s.salary,onChange:d})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Priority Level"}),e.jsxs("div",{className:"star-rating",children:[[1,2,3].map(t=>e.jsx("button",{type:"button",className:`star-btn ${t<=n?"active":""}`,title:R[t],onClick:()=>l(t),children:"★"},t)),e.jsx("span",{className:"star-label",children:R[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tags",children:"Tags"}),e.jsx("input",{type:"text",id:"tags",name:"tags",placeholder:"e.g., remote, startup, fintech",value:s.tags,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",name:"notes",rows:2,placeholder:"Any notes about this position...",value:s.notes,onChange:d})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:h?"Update Application":"Save Application"})}),e.jsxs("details",{className:"additional-urls",children:[e.jsx("summary",{children:"Additional Links (optional)"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"companyUrl",children:"Company Website"}),e.jsx("input",{type:"url",id:"companyUrl",name:"companyUrl",placeholder:"e.g., https://company.com",value:s.companyUrl,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"portalUrl",children:"Application Portal"}),e.jsx("input",{type:"url",id:"portalUrl",name:"portalUrl",placeholder:"e.g., https://workday.company.com",value:s.portalUrl,onChange:d})]})]})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:c.total}),e.jsx("span",{className:"stat-label",children:"Tracked"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:c.applied}),e.jsx("span",{className:"stat-label",children:"Applied"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:c.interviewing}),e.jsx("span",{className:"stat-label",children:"Interviewing"})]})]}),b.length>0&&e.jsxs("div",{className:"recent-postings",children:[e.jsxs("div",{className:"recent-header",children:["Recent (",b.length,")"]}),e.jsx("ul",{className:"recent-list",children:b.map(t=>e.jsxs("li",{className:"recent-item",onClick:()=>{chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${t.id}`)})},children:[e.jsx("span",{className:"recent-title",children:t.title}),e.jsxs("span",{className:"recent-company",children:["@ ",t.company]}),e.jsxs("span",{className:"recent-priority",children:["★".repeat(t.priority),"☆".repeat(3-t.priority)]})]},t.id))})]}),A&&e.jsx("div",{className:"notice notice-success",children:"Job saved successfully!"}),C&&e.jsx("div",{className:"notice notice-error",children:e.jsx("span",{children:C})})]})}W.createRoot(document.getElementById("root")).render(e.jsx(_.StrictMode,{children:e.jsx(V,{})}));
