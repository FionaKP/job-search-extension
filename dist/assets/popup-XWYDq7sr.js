import{r as t,j as e,e as pe,c as xe,R as ge}from"./extractor-BlsyOXNW.js";const je={1:"Not interested",2:"Low",3:"Medium",4:"High",5:"Very excited!"},fe=["remote","hybrid","onsite","startup","enterprise","contract"],b="postings";async function S(){return(await chrome.storage.local.get(b))[b]||[]}async function ye(a){const l=await S(),i=Date.now();let r,o;if(a.description)try{r=pe(a.description),o=i}catch(j){console.warn("Failed to extract keywords:",j)}const d={id:`job_${i}_${Math.random().toString(36).substring(2,9)}`,url:a.url||"",company:a.company||"",companyLogo:a.companyLogo,title:a.title||"",location:a.location||"",description:a.description||"",salary:a.salary,status:"saved",interest:a.interest||3,dateAdded:i,dateModified:i,notes:a.notes||"",tags:a.tags||[],connectionIds:[],keywords:r,keywordsExtractedAt:o};return l.unshift(d),await chrome.storage.local.set({[b]:l}),d}async function ve(a,l){const i=await S(),r=i.findIndex(o=>o.id===a);return r===-1?null:(i[r]={...i[r],...l,dateModified:Date.now()},await chrome.storage.local.set({[b]:i}),i[r])}async function we(a){const l=await S(),i=o=>{try{const d=new URL(o);return`${d.origin}${d.pathname}`.replace(/\/$/,"")}catch{return o}},r=i(a);return l.find(o=>i(o.url)===r)||null}function Ne(){const[a,l]=t.useState(""),[i,r]=t.useState(""),[o,d]=t.useState(void 0),[j,C]=t.useState(""),[B,k]=t.useState(""),[L,H]=t.useState(""),[h,f]=t.useState([]),[V,W]=t.useState(""),[_,T]=t.useState(""),[U,E]=t.useState(3),[R,X]=t.useState(!1),[,Z]=t.useState(null),[c,y]=t.useState({source:"",confidence:0,isLoading:!1,error:null}),[v,q]=t.useState(!1),[P,ee]=t.useState({total:0,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0}),[z,se]=t.useState([]),[A,D]=t.useState(!0),[G,K]=t.useState(!1),[te,ne]=t.useState(!1),[u,x]=t.useState(null),[p,ae]=t.useState(null),[g,ie]=t.useState(""),[O,re]=t.useState(!1),M=t.useCallback(async()=>{const s=await S(),n={total:s.length,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0};s.forEach(m=>{m.status in n&&n[m.status]++}),ee(n),se(s.slice(0,3))},[]),w=t.useCallback(s=>{l(s.title||""),r(s.company||""),d(s.companyLogo||void 0),C(s.location||""),k(s.salary||""),H(s.description||""),"tags"in s&&Array.isArray(s.tags)&&f(s.tags),"notes"in s&&T(s.notes||""),"interest"in s&&E(s.interest),"source"in s&&"confidence"in s&&(Z(s),y({source:s.source||"",confidence:s.confidence||0,isLoading:!1,error:!s.title&&!s.company?"Could not detect job details. Please fill in manually.":null}))},[]),I=t.useCallback(async s=>{y(n=>({...n,isLoading:!0,error:null}));try{await new Promise(m=>setTimeout(m,50));const n=await chrome.tabs.sendMessage(s,{action:"scrapeJob"});n&&w(n)}catch(n){console.log("Scraping not available:",n),y({source:"",confidence:0,isLoading:!1,error:"This page cannot be scraped. Please fill in manually."})}},[w]);t.useEffect(()=>{async function s(){D(!0);try{const m=new URLSearchParams(window.location.search).get("sourceUrl");let $=null,N;if(m)N=m,re(!0);else{const[Q]=await chrome.tabs.query({active:!0,currentWindow:!0});N=Q.url||"",$=Q.id||null}ie(N);const J=await we(N);J?(ae(J),w(J)):$&&await I($),await M()}catch(n){console.error("Init error:",n),x("Could not load page information")}finally{D(!1)}}s()},[w,I,M]);const ce=async s=>{if(s.preventDefault(),x(null),!a.trim()){x("Job title is required");return}if(!i.trim()){x("Company name is required");return}K(!0);try{const n={url:g,title:a.trim(),company:i.trim(),companyLogo:o,location:j.trim(),salary:B.trim()||void 0,description:L.trim(),notes:_.trim(),interest:U,tags:h};p?await ve(p.id,n):await ye(n),ne(!0),await M(),O||setTimeout(()=>window.close(),1500)}catch(n){console.error("Save error:",n),x("Failed to save application")}finally{K(!1)}},Y=s=>{const n=s.trim().toLowerCase();n&&!h.includes(n)&&f([...h,n]),W("")},oe=s=>{f(h.filter(n=>n!==s))},le=s=>{(s.key==="Enter"||s.key===",")&&(s.preventDefault(),Y(V))},F=()=>{q(!0),y({source:"",confidence:0,isLoading:!1,error:null}),l(""),r(""),d(void 0),C(""),k(""),H(""),f([]),T(""),E(3)},de=()=>{chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},ue=()=>{const s=chrome.runtime.getURL("src/popup/popup.html")+"?sourceUrl="+encodeURIComponent(g);chrome.tabs.create({url:s}),window.close()},he=(()=>{try{const s=new URL(g),n=s.pathname.slice(0,25);return s.hostname+n+(s.pathname.length>25?"...":"")}catch{return g.slice(0,35)+"..."}})(),me=s=>s>=.6?"notice-success":s>=.3?"notice-warning":"notice-error";return e.jsxs("div",{className:"popup-container",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"JobFlow"}),e.jsxs("div",{className:"header-actions",children:[!O&&e.jsx("button",{className:"btn-icon",title:"Open in new tab",onClick:ue,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})}),e.jsx("button",{className:"btn-icon",title:"Open Dashboard",onClick:de,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})}),e.jsx("button",{className:"btn-icon",title:"Settings",onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL("index.html?view=settings")}),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]})]}),e.jsxs("div",{className:"current-url",children:[e.jsx("span",{className:"url-label",children:"From:"}),e.jsx("span",{className:"url-text",title:g,children:he})]}),c.isLoading&&e.jsxs("div",{className:"notice notice-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Scanning page..."})]}),v&&!c.isLoading&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"Manual entry mode"}),e.jsx("button",{className:"btn-link",onClick:async()=>{q(!1);const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});s.id&&I(s.id)},children:"Try auto-detect"})]}),!v&&c.source&&!c.isLoading&&c.confidence>0&&e.jsxs("div",{className:`notice ${me(c.confidence)}`,children:[e.jsxs("span",{children:[e.jsx("strong",{children:c.source})," • ",Math.round(c.confidence*100),"% confidence"]}),e.jsx("button",{className:"btn-link",onClick:F,children:"Edit manually"})]}),!v&&c.error&&e.jsxs("div",{className:"notice notice-warning",children:[e.jsx("span",{children:c.error}),e.jsx("button",{className:"btn-link",onClick:F,children:"Enter manually"})]}),!v&&!c.isLoading&&!c.source&&!c.error&&!p&&!A&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"No job detected on this page"}),e.jsx("button",{className:"btn-link",onClick:F,children:"Enter manually"})]}),p&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"Already saved"}),e.jsx("button",{className:"btn-link",onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${p.id}`)}),children:"View"})]}),A&&e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Loading..."})]}),!A&&e.jsxs("form",{className:"job-form",onSubmit:ce,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Job Title *"}),e.jsx("input",{type:"text",id:"title",value:a,onChange:s=>l(s.target.value),placeholder:"e.g., Software Engineer",className:u!=null&&u.includes("title")?"error":""})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company",children:"Company *"}),e.jsx("input",{type:"text",id:"company",value:i,onChange:s=>r(s.target.value),placeholder:"e.g., Acme Corp",className:u!=null&&u.includes("Company")?"error":""})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",value:j,onChange:s=>C(s.target.value),placeholder:"e.g., Remote"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"salary",children:"Salary"}),e.jsx("input",{type:"text",id:"salary",value:B,onChange:s=>k(s.target.value),placeholder:"e.g., $150k"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Interest"}),e.jsxs("div",{className:"star-rating",children:[[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",className:`star-btn ${s<=U?"active":""}`,onClick:()=>E(s),children:"★"},s)),e.jsx("span",{className:"star-label",children:je[U]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tags"}),e.jsxs("div",{className:"tags-container",children:[h.map(s=>e.jsxs("span",{className:"tag-chip",children:[s,e.jsx("button",{type:"button",onClick:()=>oe(s),className:"tag-remove",children:"×"})]},s)),e.jsx("input",{type:"text",value:V,onChange:s=>W(s.target.value),onKeyDown:le,placeholder:h.length===0?"Add tags...":"",className:"tag-input"})]}),h.length===0&&e.jsx("div",{className:"suggested-tags",children:fe.slice(0,4).map(s=>e.jsxs("button",{type:"button",onClick:()=>Y(s),className:"suggested-tag",children:["+ ",s]},s))})]}),L&&e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"description-header",children:[e.jsx("label",{children:"Description"}),e.jsx("button",{type:"button",onClick:()=>X(!R),className:"btn-link",children:R?"Hide":"Show"})]}),R&&e.jsx("div",{className:"description-preview",children:L})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",value:_,onChange:s=>T(s.target.value),rows:2,placeholder:"Personal notes..."})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:G,children:G?"Saving...":p?"Update":"Save to JobFlow"})})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:P.total}),e.jsx("span",{className:"stat-label",children:"Tracked"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:P.applied}),e.jsx("span",{className:"stat-label",children:"Applied"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:P.interviewing}),e.jsx("span",{className:"stat-label",children:"Interviews"})]})]}),z.length>0&&e.jsxs("div",{className:"recent-postings",children:[e.jsx("div",{className:"recent-header",children:"Recent"}),e.jsx("ul",{className:"recent-list",children:z.map(s=>e.jsxs("li",{className:"recent-item",onClick:()=>chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${s.id}`)}),children:[e.jsx("span",{className:"recent-title",children:s.title}),e.jsxs("span",{className:"recent-company",children:["@ ",s.company]})]},s.id))})]}),te&&e.jsx("div",{className:"notice notice-success",children:"Saved successfully!"}),u&&e.jsx("div",{className:"notice notice-error",children:u})]})}xe.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(Ne,{})}));
