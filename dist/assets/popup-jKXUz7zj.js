import{r as l,j as e,c as B,R as O}from"./client-DYDkQYN6.js";const M=["Not rated","Low interest","Somewhat interested","Interested","Very interested","Top choice"],w="jobApplications";async function f(){return(await chrome.storage.local.get(w))[w]||[]}async function W(t){const r=await f(),n={id:`job_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,url:t.url||"",company:t.company||"",title:t.title||"",location:t.location||"",description:t.description||"",salary:t.salary,status:"saved",dateAdded:new Date().toISOString(),notes:t.notes||"",tags:t.tags||[],interest:t.interest||0};return r.unshift(n),await chrome.storage.local.set({[w]:r}),n}async function _(t,r){const n=await f(),c=n.findIndex(i=>i.id===t);return c===-1?null:(n[c]={...n[c],...r},await chrome.storage.local.set({[w]:n}),n[c])}async function q(t){const r=await f(),n=i=>{try{const x=new URL(i);return`${x.origin}${x.pathname}`.replace(/\/$/,"")}catch{return i}},c=n(t);return r.find(i=>n(i.url)===c)||null}async function V(){const t=await f(),r={total:t.length,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0};return t.forEach(n=>{n.status in r&&r[n.status]++}),r}function z(){const[t,r]=l.useState({url:"",title:"",company:"",location:"",salary:"",tags:"",notes:"",companyUrl:"",portalUrl:""}),[n,c]=l.useState(0),[i,x]=l.useState({total:0,saved:0,applied:0,interviewing:0,offer:0,rejected:0,withdrawn:0}),[N,S]=l.useState(!0),[k,E]=l.useState(!1),[U,g]=l.useState(null),[p,I]=l.useState(null),[h,L]=l.useState(""),[C,R]=l.useState(!1),b=l.useCallback(async()=>{const s=await V();x(s)},[]),y=l.useCallback(s=>{r(a=>({...a,title:s.title||a.title,company:s.company||a.company,location:s.location||a.location,salary:s.salary||a.salary,notes:s.notes||a.notes,tags:Array.isArray(s.tags)?s.tags.join(", "):a.tags})),s.interest&&c(s.interest)},[]),A=l.useCallback(async s=>{try{await chrome.scripting.executeScript({target:{tabId:s},files:["src/content/scraper.ts"]}),await new Promise(o=>setTimeout(o,100));const a=await chrome.tabs.sendMessage(s,{action:"scrapeJob"});a&&y(a)}catch(a){console.log("Scraping not available on this page:",a)}},[y]);l.useEffect(()=>{async function s(){S(!0);try{const o=new URLSearchParams(window.location.search).get("sourceUrl");let m=null,u;if(o)u=o,R(!0);else{const[j]=await chrome.tabs.query({active:!0,currentWindow:!0});u=j.url||"",m=j.id||null}L(u),r(j=>({...j,url:u}));const v=await q(u);v?(I(v.id),y(v)):m&&await A(m),await b()}catch(a){console.error("Init error:",a),g("Could not load page information")}finally{S(!1)}}s()},[y,A,b]);const d=s=>{const{name:a,value:o}=s.target;r(m=>({...m,[a]:o}))},T=async s=>{if(s.preventDefault(),!t.title.trim()||!t.company.trim()){g("Please enter job title and company");return}try{const a={url:h,title:t.title.trim(),company:t.company.trim(),location:t.location.trim(),salary:t.salary.trim(),notes:t.notes.trim(),interest:n,tags:t.tags.split(",").map(o=>o.trim().toLowerCase()).filter(o=>o.length>0)};p?await _(p,a):await W(a),E(!0),g(null),await b(),C||setTimeout(()=>window.close(),1500)}catch(a){console.error("Save error:",a),g("Failed to save application")}},F=()=>{chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},P=()=>{const s=chrome.runtime.getURL("src/popup/popup.html")+"?sourceUrl="+encodeURIComponent(h);chrome.tabs.create({url:s}),window.close()},$=()=>{chrome.tabs.create({url:chrome.runtime.getURL(`index.html?highlight=${p}`)})},J=(()=>{try{const s=new URL(h),a=s.pathname.slice(0,30);return s.hostname+a+(s.pathname.length>30?"...":"")}catch{return h.slice(0,40)+"..."}})();return e.jsxs("div",{className:"popup-container",children:[e.jsxs("header",{className:"header",children:[e.jsx("h1",{children:"Job Tracker"}),e.jsxs("div",{className:"header-actions",children:[!C&&e.jsx("button",{className:"btn-icon",title:"Open in new tab (stays open while you copy/paste)",onClick:P,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})}),e.jsx("button",{className:"btn-icon",title:"Open Dashboard",onClick:F,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})})]})]}),e.jsxs("div",{className:"current-url",children:[e.jsx("span",{className:"url-label",children:"Saving from:"}),e.jsx("span",{className:"url-text",title:h,children:J})]}),p&&e.jsxs("div",{className:"notice notice-info",children:[e.jsx("span",{children:"This job is already saved"}),e.jsx("button",{className:"btn-link",onClick:$,children:"View in Dashboard"})]}),N&&e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Scanning page..."})]}),!N&&e.jsxs("form",{className:"job-form",onSubmit:T,children:[e.jsx("input",{type:"hidden",name:"url",value:t.url}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Job Title *"}),e.jsx("input",{type:"text",id:"title",name:"title",placeholder:"e.g., Software Engineer",required:!0,value:t.title,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company",children:"Company *"}),e.jsx("input",{type:"text",id:"company",name:"company",placeholder:"e.g., Acme Corp",required:!0,value:t.company,onChange:d})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{type:"text",id:"location",name:"location",placeholder:"e.g., Remote",value:t.location,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"salary",children:"Salary"}),e.jsx("input",{type:"text",id:"salary",name:"salary",placeholder:"e.g., $100k",value:t.salary,onChange:d})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Interest Level"}),e.jsxs("div",{className:"star-rating",children:[[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",className:`star-btn ${s<=n?"active":""}`,title:`${s} star${s>1?"s":""}`,onClick:()=>c(s),children:"â˜…"},s)),e.jsx("span",{className:"star-label",children:M[n]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tags",children:"Tags"}),e.jsx("input",{type:"text",id:"tags",name:"tags",placeholder:"e.g., remote, startup, fintech",value:t.tags,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",name:"notes",rows:2,placeholder:"Any notes about this position...",value:t.notes,onChange:d})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:p?"Update Application":"Save Application"})}),e.jsxs("details",{className:"additional-urls",children:[e.jsx("summary",{children:"Additional Links (optional)"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"companyUrl",children:"Company Website"}),e.jsx("input",{type:"url",id:"companyUrl",name:"companyUrl",placeholder:"e.g., https://company.com",value:t.companyUrl,onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"portalUrl",children:"Application Portal"}),e.jsx("input",{type:"url",id:"portalUrl",name:"portalUrl",placeholder:"e.g., https://workday.company.com",value:t.portalUrl,onChange:d})]})]})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:i.total}),e.jsx("span",{className:"stat-label",children:"Tracked"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:i.applied}),e.jsx("span",{className:"stat-label",children:"Applied"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:i.interviewing}),e.jsx("span",{className:"stat-label",children:"Interviewing"})]})]}),k&&e.jsx("div",{className:"notice notice-success",children:"Job saved successfully!"}),U&&e.jsx("div",{className:"notice notice-error",children:e.jsx("span",{children:U})})]})}B.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(z,{})}));
